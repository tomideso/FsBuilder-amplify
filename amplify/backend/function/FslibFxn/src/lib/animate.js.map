{"version":3,"sources":["animate.ts"],"names":["targetClass","methods","animate","action","target","animation","duration","easing","effects","effect","String","replace","addStyle","children","propsFrom","map","el","getProps","childrenMargin","oldHeight","oldScrollY","window","pageYOffset","Transition","cancel","forEach","reset","fastdom","flush","newHeight","concat","filter","propsTo","i","parentNode","getPositionWithMargin","opacity","props","from","style","Promise","all","transform","start","resolve","height","then","display","zIndex","noop","pointerEvents","position","left","top","width","margin","getBoundingClientRect","document","head","sheet","insertRule","fGetCSSProperty","s","e","currentStyle","getComputedStyle","x","fGetOffSetParent","a","offsetParent","body","tagName","GetPosition","b","Left","offsetLeft","Top","offsetTop"],"mappings":"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","file":"animate.js","sourcesContent":["import {\n  addClass,\n  append,\n  assign,\n  css,\n  fastdom,\n  height,\n  includes,\n  index,\n  isVisible,\n  noop,\n  position,\n  Promise,\n  removeClass,\n  scrollTop,\n  toFloat,\n  toNodes,\n  Transition,\n} from \"../js/util/index\";\n\nconst targetClass = \"uk-animation-target\";\n\nexport default {\n  // props: {\n  //     animation: Number\n  // },\n\n  // data: {\n  //     animation: 400\n  // },\n\n  // computed: {\n\n  //     target() {\n  //         return this.$el;\n  //     }\n\n  // },\n\n  methods: {\n    animate(action, target, animation) {\n      const { duration, easing, effects } = animation;\n      const effect = String(effects).replace(/^fade /gi, \"\");\n      addStyle();\n\n      let children = toNodes(target.children);\n      let propsFrom = children.map((el) => getProps(el, true));\n      let childrenMargin = children.map((el) => css(el, \"margin\"));\n\n      const oldHeight = height(target);\n      const oldScrollY = window.pageYOffset;\n\n      action();\n\n      Transition.cancel(target);\n      children.forEach(Transition.cancel);\n\n      reset(target);\n      // this.$update(target);\n      fastdom.flush();\n\n      const newHeight = height(target);\n\n      children = children.concat(\n        toNodes(target.children).filter((el) => !includes(children, el))\n      );\n\n      const propsTo = children.map((el, i) =>\n        el.parentNode && i in propsFrom\n          ? propsFrom[i]\n            ? isVisible(el)\n              ? getPositionWithMargin(el)\n              : { opacity: 0 }\n            : { opacity: isVisible(el) ? 1 : 0 }\n          : false\n      );\n\n      propsFrom = propsTo.map((props, i) => {\n        const from =\n          children[i].parentNode === target\n            ? propsFrom[i] || getProps(children[i])\n            : false;\n\n        if (from) {\n          if (!props) {\n            delete from.opacity;\n          } else if (!(\"opacity\" in props)) {\n            const { opacity } = from;\n\n            if (opacity % 1) {\n              props.opacity = 1;\n            } else {\n              delete from.opacity;\n            }\n          }\n        }\n\n        return from;\n      });\n\n      addClass(target, targetClass);\n      children.forEach((el, i) => {\n        if (propsFrom[i]) {\n          css(el, propsFrom[i]);\n        }\n      });\n\n      css(target, \"height\", oldHeight);\n      children.map((el, i) => (el.style[\"margin\"] = childrenMargin[i]));\n      scrollTop(window, oldScrollY);\n\n      return Promise.all(\n        children\n          .map((el, i) => {\n            if (propsFrom[i] && propsTo[i]) {\n              if (propsTo[i].opacity == 0) {\n                propsTo[i].transform = effect;\n              } else {\n                propsTo[i].transform = \"\";\n              }\n              if (propsFrom[i].opacity == 0) {\n                el.style.transform = effect;\n              }\n              return Transition.start(el, propsTo[i], duration, easing);\n            }\n            return Promise.resolve();\n          })\n          .concat(\n            Transition.start(target, { height: newHeight }, duration, easing)\n          )\n      ).then(() => {\n        children.forEach((el, i) => {\n          css(el, {\n            display: propsTo[i].opacity === 0 ? \"none\" : \"\",\n            zIndex: \"\",\n          });\n        });\n        reset(target);\n        // this.$update(target);\n        fastdom.flush(); // needed for IE11ssa\n      }, noop);\n    },\n  },\n};\n\nfunction getProps(el, opacity?) {\n  const zIndex = css(el, \"zIndex\");\n\n  return isVisible(el)\n    ? assign(\n        {\n          display: \"\",\n          opacity: opacity ? css(el, \"opacity\") : \"0\",\n          pointerEvents: \"none\",\n          position: \"absolute\",\n          zIndex: zIndex === \"auto\" ? index(el) : zIndex,\n        },\n        getPositionWithMargin(el)\n      )\n    : false;\n}\n\nexport function reset(el) {\n  css(el.children, {\n    height: \"\",\n    left: \"\",\n    opacity: \"\",\n    pointerEvents: \"\",\n    transform: \"\",\n    position: \"\",\n    top: \"\",\n    width: \"\",\n    margin: \"\",\n  });\n  removeClass(el, targetClass);\n  css(el, \"height\", \"\");\n}\n\nexport function getPositionWithMargin(el) {\n  const { height, width } = el.getBoundingClientRect();\n  let { top, left } = position(el);\n  top += toFloat(css(el, \"marginTop\"));\n  return { top, left, height, width };\n}\n\nlet style;\n\nfunction addStyle() {\n  if (style) {\n    return;\n  }\n  style = append(document.head, \"<style>\").sheet;\n  style.insertRule(\n    `.${targetClass} > * {\n            margin-top: 0 !important;\n            /*transform: none !important;*/\n        }`,\n    0\n  );\n}\n\nfunction fGetCSSProperty(s, e) {\n  try {\n    return s.currentStyle ? s.currentStyle[e] : window.getComputedStyle(s)[e];\n  } catch (x) {\n    return null;\n  }\n}\nfunction fGetOffSetParent(s) {\n  var a = s.offsetParent || document.body;\n\n  while (\n    a &&\n    a.tagName &&\n    a != document.body &&\n    fGetCSSProperty(a, \"position\") == \"static\"\n  )\n    a = a.offsetParent;\n  return a;\n}\nfunction GetPosition(s) {\n  var b = fGetOffSetParent(s);\n\n  return { Left: b.offsetLeft + s.offsetLeft, Top: b.offsetTop + s.offsetTop };\n}\n"]}