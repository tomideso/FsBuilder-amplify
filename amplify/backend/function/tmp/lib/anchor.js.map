{"version":3,"sources":["anchor.ts"],"names":["FsLibrary","prototype","anchor","anchorButton","buttonsTarget","activeClass","anchorId","cms","getMasterCollection","active","String","replace","targetHolder","document","querySelector","innerHTML","testimonials","slice","call","querySelectorAll","Webflow","window","done","map","elem","idx","arr","anchor_link","textContent","trim","sidebar_link","id","href","sidelink","outerHTML","appendChild","classList","add","Promise","resolve","all","then","onScroll","removeActiveClassFromTriggers","target","Array","from","forEach","remove","i","match","targetElem","getElementById","check","bottom","top"],"mappings":"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","file":"anchor.js","sourcesContent":["import { FsLibrary } from \"./fsLibrary\";\nimport {\n  createElementFromHTML,\n  registerListener,\n  isOutOfViewport,\n} from \"./utility\";\n\nFsLibrary.prototype.anchor = function ({\n  anchorButton,\n  buttonsTarget,\n  activeClass,\n  anchorId,\n}) {\n  const cms = this.getMasterCollection();\n  const active = String(activeClass).replace(\".\", \"\");\n\n  const targetHolder = document.querySelector(buttonsTarget);\n  targetHolder.innerHTML = \"\";\n\n  const testimonials = [].slice.call(cms.querySelectorAll(\".w-dyn-item>div\"));\n\n  const Webflow = (<any>window).Webflow || [];\n\n  // Webflow.push(function () {\n  const done = testimonials.map((elem, idx, arr) => {\n    let anchor_link = elem.querySelector(anchorId).textContent.trim();\n    anchor_link = anchor_link.replace(/\\s+/gi, \"-\");\n    const sidebar_link = elem.querySelector(anchorButton);\n\n    elem.id = anchor_link;\n    sidebar_link.href = \"#\" + anchor_link;\n\n    const sidelink: any = createElementFromHTML(sidebar_link.outerHTML);\n\n    targetHolder.appendChild(sidelink);\n\n    if (idx == 0) {\n      sidelink.classList.add(active);\n    }\n\n    return Promise.resolve();\n  });\n\n  Promise.all(done).then(() => {\n    registerListener(\"scroll\", onScroll);\n  });\n\n  // });\n\n  const removeActiveClassFromTriggers = (target, activeClass) => {\n    Array.from(document.querySelectorAll(buttonsTarget + \">a\")).forEach(\n      (elem) => {\n        if (elem.outerHTML != target.outerHTML) {\n          elem.classList.remove(activeClass);\n        }\n      }\n    );\n  };\n\n  const onScroll = () => {\n    Array.from(document.querySelectorAll(buttonsTarget + \">a\")).forEach(\n      (elem, i) => {\n        const href = (<any>elem).href.match(/#(.*)?/)[1];\n        const targetElem = document.getElementById(href);\n        // const deepest = findDeepestChildElement(targetElem);\n        const check = isOutOfViewport(targetElem);\n\n        if (!check.bottom && !check.top) {\n          removeActiveClassFromTriggers(elem, active);\n          elem.classList.add(active);\n        } else {\n          elem.classList.remove(active);\n        }\n      }\n    );\n  };\n};\n"]}