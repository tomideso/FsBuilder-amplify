{"version":3,"sources":["loadmore/index.ts"],"names":["FsLibrary","prototype","loadmore","config","button","loadAll","resetIx","animation","infiniteScroll","infiniteScrollPercentage","indexSet","setNextButtonIndex","master_collection","getMasterCollection","getCollections","setHiddenCollections","effects","replace","duration","easing","makeStyleSheet","transform","nextButton","getLoadmoreHref","setAttribute","href","removeAttribute","busy","onclick","evt","initFetch","initScroll","parent","children","len","length","pos","Math","round","bottom","console","log","document","addEventListener","event","recursive","getAttribute","getNextData","then","res","appendPaginatedData","reinitializeWebflow","nextcollection","hidden_collections","shift","appendToCms","firstElementChild","aHref","querySelector","setLoadmoreHref","index"],"mappings":"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","file":"index.js","sourcesContent":["import { FsLibrary } from \"../fsLibrary\";\nimport \"./util\";\nimport { throttle, isInViewport, isOutOfViewport } from \"../utility\";\n\nFsLibrary.prototype.loadmore = function (\n  config: LoadMore = {\n    button: \"a.w-pagination-next\",\n    loadAll: false,\n    resetIx: true,\n    animation: this.animation,\n    infiniteScroll: false,\n    infiniteScrollPercentage: 80,\n  }\n): void {\n  if (!this.indexSet) {\n    this.setNextButtonIndex();\n  }\n\n  const master_collection = this.getMasterCollection();\n  const getCollections = () => this.getMasterCollection();\n  this.setHiddenCollections();\n\n  if (config.animation) {\n    const effects = config.animation.effects.replace(\"fade\", \"\");\n    let { duration, easing } = config.animation;\n    duration = duration ? duration / 1000 : 1;\n    easing = easing || \"linear\";\n    this.makeStyleSheet({ duration, easing, transform: effects });\n  } else {\n    this.makeStyleSheet({});\n  }\n\n  const {\n    button,\n    resetIx = false,\n    loadAll = false,\n    infiniteScroll = false,\n    infiniteScrollPercentage = 80,\n  } = config;\n\n  const nextButton = this.getLoadmoreHref(button);\n  nextButton.setAttribute(\"data-href\", (<any>nextButton).href);\n  nextButton.removeAttribute(\"href\");\n\n  let busy = false;\n\n  (<any>nextButton).onclick = (evt) => {\n    initFetch();\n  };\n\n  const initScroll = throttle((evt) => {\n    const parent = getCollections();\n    const children = parent.children;\n    const len = children.length;\n\n    const pos = Math.round((infiniteScrollPercentage * len) / 100);\n\n    if (isInViewport(children[pos]) || !isOutOfViewport(parent).bottom) {\n      initFetch();\n    }\n  }, 700);\n\n  if (infiniteScroll) {\n    console.log(\"infinite scroll added\");\n    document.addEventListener(\"scroll\", initScroll);\n  }\n\n  document.addEventListener(\"DOMContentLoaded\", function (event) {\n    loadAll && initFetch(true);\n  });\n\n  const initFetch = (recursive = false) => {\n    if (busy) return false;\n\n    const href = nextButton.getAttribute(\"data-href\");\n\n    busy = true;\n\n    if (href) {\n      return this.getNextData(href).then((res) => {\n        //enable button\n        this.appendPaginatedData(<any>res);\n        busy = false;\n\n        if (resetIx) {\n          this.reinitializeWebflow();\n        }\n\n        if (recursive) {\n          initFetch(true);\n        }\n      });\n    }\n\n    const nextcollection = this.hidden_collections.shift();\n\n    if (nextcollection) {\n      this.appendToCms(nextcollection.firstElementChild.children).then(\n        (res) => {\n          if (resetIx) {\n            this.reinitializeWebflow();\n          }\n        }\n      );\n      const aHref = nextcollection.querySelector(\".w-pagination-next\");\n      this.setLoadmoreHref(aHref.href);\n      this.index++;\n      busy = false;\n\n      if (recursive) {\n        initFetch(true);\n      }\n    }\n  };\n};\n\ninterface LoadMore {\n  button: string;\n  loadAll?: boolean;\n  resetIx?: boolean;\n  animation?: Animatn;\n  infiniteScroll?: boolean;\n  infiniteScrollPercentage?: number;\n}\n\ninterface Animatn {\n  enable?: boolean;\n  easing?: string;\n  duration?: number;\n  effects?: string;\n  queue?: boolean;\n}\n"]}