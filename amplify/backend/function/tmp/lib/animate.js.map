{"version":3,"sources":["animate.ts"],"names":["targetClass","methods","animate","action","target","animation","duration","easing","effects","effect","String","replace","addStyle","children","propsFrom","map","el","getProps","childrenMargin","oldHeight","oldScrollY","window","pageYOffset","Transition","cancel","forEach","reset","fastdom","flush","newHeight","concat","filter","propsTo","i","parentNode","getPositionWithMargin","opacity","props","from","style","Promise","all","transform","start","resolve","height","then","display","zIndex","noop","pointerEvents","position","left","top","width","margin","getBoundingClientRect","document","head","sheet","insertRule","fGetCSSProperty","s","e","currentStyle","getComputedStyle","x","fGetOffSetParent","a","offsetParent","body","tagName","GetPosition","b","Left","offsetLeft","Top","offsetTop"],"mappings":"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","file":"animate.js","sourcesContent":["import { addClass, append, assign, css, fastdom, height, includes, index, isVisible, noop, position, Promise, removeClass, scrollTop, toFloat, toNodes, Transition } from '../js/util/index';\n\nconst targetClass = 'uk-animation-target';\n\nexport default {\n\n    // props: {\n    //     animation: Number\n    // },\n\n    // data: {\n    //     animation: 400\n    // },\n\n    // computed: {\n\n    //     target() {\n    //         return this.$el;\n    //     }\n\n    // },\n\n    methods: {\n\n        animate(action, target, animation) {\n            const { duration, easing, effects } = animation;\n            const effect = String(effects).replace(/^fade /gi, \"\");\n            addStyle();\n\n            let children = toNodes(target.children);\n            let propsFrom = children.map(el => getProps(el, true));\n            let childrenMargin = children.map(el=>css(el, 'margin'));\n\n            const oldHeight = height(target);\n            const oldScrollY = window.pageYOffset;\n\n            action();\n\n            Transition.cancel(target);\n            children.forEach(Transition.cancel);\n\n            reset(target);\n            // this.$update(target);\n            fastdom.flush();\n\n            const newHeight = height(target);\n\n            children = children.concat(toNodes(target.children).filter(el => !includes(children, el)));\n\n            const propsTo = children.map((el, i) =>\n                el.parentNode && i in propsFrom\n                    ? propsFrom[i]\n                        ? isVisible(el)\n                            ? getPositionWithMargin(el)\n                            : { opacity: 0 }\n                        : { opacity: isVisible(el) ? 1 : 0 }\n                    : false\n            );\n\n            propsFrom = propsTo.map((props, i) => {\n                const from = children[i].parentNode === target\n                    ? propsFrom[i] || getProps(children[i])\n                    : false;\n\n                if (from) {\n                    if (!props) {\n                        delete from.opacity;\n                    } else if (!('opacity' in props)) {\n                        const { opacity } = from;\n\n                        if (opacity % 1) {\n                            props.opacity = 1;\n                        } else {\n                            delete from.opacity;\n                        }\n                    }\n                }\n\n                return from;\n            });\n\n            addClass(target, targetClass);\n            children.forEach((el, i) => {\n                if (propsFrom[i]) {\n                    css(el, propsFrom[i])\n                }\n            });\n\n            css(target, 'height', oldHeight);\n            children.map((el,i)=>el.style[\"margin\"]=childrenMargin[i])\n            scrollTop(window, oldScrollY);\n\n            return Promise.all(\n                children.map((el, i) => {\n                    \n                    if (propsFrom[i] && propsTo[i]) {\n                        if(propsTo[i].opacity==0){\n                            propsTo[i].transform=effect;\n                        }\n                        else{\n                            propsTo[i].transform='';\n                        }\n                        if(propsFrom[i].opacity==0){\n                            el.style.transform=effect;\n                        }\n                        return Transition.start(el, propsTo[i], duration, easing)\n                    }\n                    return Promise.resolve();\n                }).concat(Transition.start(target, { height: newHeight }, duration, easing))\n            )\n                .then(() => {\n\n                    children.forEach((el, i) => {\n                        css(el, { display: propsTo[i].opacity === 0 ? 'none' : '', zIndex: '' })\n                    });\n                    reset(target);\n                    // this.$update(target);\n                    fastdom.flush(); // needed for IE11ssa\n                }, noop);\n\n        }\n    }\n};\n\n\nfunction getProps(el, opacity?) {\n    const zIndex = css(el, 'zIndex');\n\n    return isVisible(el)\n        ? assign({\n            display: '',\n            opacity: opacity ? css(el, 'opacity') : '0',\n            pointerEvents: 'none',\n            position: 'absolute',\n            zIndex: zIndex === 'auto' ? index(el) : zIndex\n        }, getPositionWithMargin(el))\n        : false;\n}\n\nexport function reset(el) {\n    css(el.children, {\n        height: '',\n        left: '',\n        opacity: '',\n        pointerEvents: '',\n        transform:'',\n        position: '',\n        top: '',\n        width: '',\n        margin:''\n    });\n    removeClass(el, targetClass);\n    css(el, 'height', '');\n}\n\nexport function getPositionWithMargin(el) {\n    const { height, width } = el.getBoundingClientRect();\n    let { top, left } = position(el);\n    top += toFloat(css(el, 'marginTop'));\n    return { top, left, height, width };\n}\n\nlet style;\n\nfunction addStyle() {\n    if (style) {\n        return;\n    }\n    style = append(document.head, '<style>').sheet;\n    style.insertRule(\n        `.${targetClass} > * {\n            margin-top: 0 !important;\n            /*transform: none !important;*/\n        }`, 0\n    );\n}\n\nfunction fGetCSSProperty(s, e) {\n    try { return s.currentStyle ? s.currentStyle[e] : window.getComputedStyle(s)[e]; }\n    catch (x) { return null; } \n}\nfunction fGetOffSetParent(s) {\n    var a = s.offsetParent || document.body;\n\n    while (a && a.tagName && a != document.body && fGetCSSProperty(a, 'position') == 'static')\n        a = a.offsetParent;\n    return a;\n}\nfunction GetPosition(s) {\n    var b = fGetOffSetParent(s);\n\n    return { Left: (b.offsetLeft + s.offsetLeft), Top: (b.offsetTop + s.offsetTop) };\n}   "]}